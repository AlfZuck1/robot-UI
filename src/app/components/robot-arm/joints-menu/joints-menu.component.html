<div class="controls-container">
    <button class="menu-toggle" (click)="toggleMenu()" aria-label="Abrir men√∫" *ngIf="!menuOpen && isSmallScreen">
        ‚ò∞ Controles
    </button>

    <div class="controls" [class.open]="menuOpen">
        <h2>Control del Brazo Rob√≥tico</h2>
        <button class="close-menu" (click)="toggleMenu()" aria-label="Cerrar men√∫" *ngIf="menuOpen">
            ‚úï
        </button>

        <!-- Manual mode toggle con indicador visual -->
        <button class="cartesian-mode" [class.active]="cartesianMode" (click)="toggleCartesianMode()"
            aria-label="Cambiar modo">
            {{ cartesianMode ? 'üü¢ Modo Cartesiano' : 'üî¥ Modo Libre' }}
        </button>

        <!-- Navegaci√≥n de submen√∫s -->
        <nav class="submenu-nav">
            <button (click)="activeSubmenu = 'controls'" [class.active]="activeSubmenu === 'controls'"
                aria-label="Controles de articulaciones">
                Controles
            </button>
            <button (click)="activeSubmenu = 'trajectories'" [class.active]="activeSubmenu === 'trajectories'"
                aria-label="Control de trayectorias">
                Trayectorias
            </button>
        </nav>

        <!-- Submen√∫ Controles -->
        <section *ngIf="activeSubmenu === 'controls'" class="submenu articulations-submenu">
            <div class="joint-controls">
                <!-- Mantener el bloque existente intacto -->
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 1 ({{ pointAngles[0].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-175" max="175" [(ngModel)]="pointAngles[0]"
                            (input)="moveSimulatedJoint('junta_0_1', pointAngles[0])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 2 ({{ pointAngles[1].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-90" max="90" [(ngModel)]="pointAngles[1]"
                            (input)="moveSimulatedJoint('junta_1_2', pointAngles[1])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 3 ({{ pointAngles[2].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-110" max="110" [(ngModel)]="pointAngles[2]"
                            (input)="moveSimulatedJoint('junta_2_3', pointAngles[2])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 4 ({{ pointAngles[3].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-180" max="180" [(ngModel)]="pointAngles[3]"
                            (input)="moveSimulatedJoint('junta_3_4', pointAngles[3])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 5 ({{ pointAngles[4].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-105" max="105" [(ngModel)]="pointAngles[4]"
                            (input)="moveSimulatedJoint('junta_4_5', pointAngles[4])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        √Ångulo 6 ({{ pointAngles[5].toFixed(2) }}¬∞)
                        <input class="joint-slider" type="range" min="-180" max="180" [(ngModel)]="pointAngles[5]"
                            (input)="moveSimulatedJoint('junta_5_6', pointAngles[5])" />
                    </label>
                </div>
                <div class="joint-control">
                    <label class="joint-label">
                        Tiempo ({{ robot.time().toFixed(2) }}s)
                        <input class="joint-slider" type="range" min="0" max="30" [(ngModel)]="robot.time" />
                    </label>
                </div>
            </div>
            <div class="trajectory-buttons">
                <button class="send-command-button" (click)="planTrajectory()" type="button">
                    Planear Trayectoria
                </button>
                <button class="add-point-button" (click)="addPoint()" type="button">
                    A√±adir Posici√≥n
                </button>
                <button class="execute-button" (click)="executePlannedTrajectory()" type="button">
                    Ejecutar Trayectoria
                </button>
                <button class="execute-command-button" (click)="executeCommand('stop')" type="button">
                    Ejecutar Comando
                </button>
            </div>
            <h3>Control Cartesiano</h3>
            <div class="axis-controls">
                <div class="axis-group">
                    <span class="axis-label">X</span>
                    <div class="button-row">
                        <button (click)="moveCartesian('x', -1)">‚ñº</button>
                        <button (click)="moveCartesian('x', 1)">‚ñ≤</button>
                    </div>
                </div>
                <div class="axis-group">
                    <span class="axis-label">Y</span>
                    <div class="button-row">
                        <button (click)="moveCartesian('y', -1)">‚ñº</button>
                        <button (click)="moveCartesian('y', 1)">‚ñ≤</button>
                    </div>
                </div>
                <div class="axis-group">
                    <span class="axis-label">Z</span>
                    <div class="button-row">
                        <button (click)="moveCartesian('z', -1)">‚ñº</button>
                        <button (click)="moveCartesian('z', 1)">‚ñ≤</button>
                    </div>
                </div>
            </div>

            <div class="rotation-controls">
                <div class="rotation-group">
                    <span class="axis-label">Yaw</span>
                    <div class="button-row">
                        <button (click)="moveRotation('qx', -1)">‚ü≤</button>
                        <button (click)="moveRotation('qx', 1)">‚ü≥</button>
                    </div>
                </div>
                <div class="rotation-group">
                    <span class="axis-label">Pitch</span>
                    <div class="button-row">
                        <button (click)="moveRotation('qy', -1)">‚ü≤</button>
                        <button (click)="moveRotation('qy', 1)">‚ü≥</button>
                    </div>
                </div>
                <div class="rotation-group">
                    <span class="axis-label">Roll</span>
                    <div class="button-row">
                        <button (click)="moveRotation('qz', -1)">‚ü≤</button>
                        <button (click)="moveRotation('qz', 1)">‚ü≥</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Submen√∫ Trayectorias -->
        <section *ngIf="activeSubmenu === 'trajectories'" class="submenu trajectories-submenu">
            <h2 class="trajectories-title">Trayectorias</h2>

            <div class="trajectory-selector">
                <label class="trajectory-label" for="trajectory-select">Seleccionar Trayectoria:</label>
                <select id="trajectory-select" class="trajectory-select" [(ngModel)]="newTrajectory"
                    (change)="onTrajectoryChange()">
                    <option *ngFor="let t of trajectories" [ngValue]="t">{{ t.name }}</option>
                </select>
            </div>

            <div class="trajectory-name">
                <input type="text" class="trajectory-name-input" placeholder="Nombre de la trayectoria"
                    [(ngModel)]="newTrajectory.name" />
            </div>

            <div class="trajectory-controls">
                <button class="add-point-btn" (click)="addPoint()">Agregar Punto</button>
                <button class="update-trajectory-btn" (click)="updateTrajectory()">Guardar Trayectoria</button>
                <button class="remove-trajectory-btn" (click)="removeTrajectory()">Eliminar Trayectoria</button>
                <button class="save-trajectory-btn" (click)="addTrajectory()">A√±adir Trayectoria</button>
            </div>

            <div class="trajectory-controls">
                <button class="plan-trajectory-btn" (click)="planMultipleTrajectory()">Planear Trayectoria</button>
                <button class="execute-trajectory-btn" (click)="executePlannedTrajectory()">Ejecutar Trayectoria</button>
            </div>

            <ul class="points-list" cdkDropList (cdkDropListDropped)="dropPoint($event)">
                <li class="point-item" *ngFor="let point of newTrajectory?.points; let idx = index" cdkDrag>
                    <div class="drag-container">
                        <span class="point-info" (click)="moveToPoint(point)">
                            Posici√≥n {{ idx + 1 }} {{ point.angles }} - Tiempo:
                            {{ point.time.toFixed(1) }}s
                        </span>

                        <button class="delete-btn" (click)="deletePoint(idx)">
                            üóëÔ∏è
                        </button>
                    </div>

                    <!-- Preview visible durante el drag -->
                    <ng-template cdkDragPreview>
                        <div class="drag-preview">
                            <span class="point-info">
                                Posici√≥n {{ idx + 1 }} {{ point.angles }} - Tiempo:
                                {{ point.time.toFixed(1) }}s
                            </span>

                            <button class="delete-btn preview-btn">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </ng-template>

                    <!-- Placeholder visual del destino -->
                    <ng-template cdkDragPlaceholder>
                        <div class="drag-placeholder"></div>
                    </ng-template>
                </li>
            </ul>

            <div class="trajectory-error" *ngIf="errorMessage">{{ errorMessage }}</div>
        </section>

    </div>
</div>